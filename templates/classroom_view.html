<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>{{ classroom_name }} | Classroom Layout</title>

    <!-- ‚úÖ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              benchFree: "#22c55e", // green
              benchAlloc: "#ef4444", // red
              board: "#1e293b", // slate
            },
          },
        },
      };
    </script>

    <!-- Tooltip style -->
    <style>
      [data-tooltip] {
        position: relative;
        cursor: pointer;
      }
      [data-tooltip]:hover::after {
        content: attr(data-tooltip);
        position: absolute;
        bottom: 120%;
        left: 50%;
        transform: translateX(-50%);
        background-color: #111827;
        color: #fff;
        padding: 6px 10px;
        border-radius: 6px;
        white-space: nowrap;
        font-size: 0.8rem;
        opacity: 0.9;
      }
    </style>
  </head>

  <body class="bg-gray-100 min-h-screen flex flex-col items-center py-8">
    <h1 class="text-3xl font-bold text-slate-800 mb-6">
      {{ classroom_name }} ‚Äî Seating Layout
    </h1>

    <!-- Blackboard -->
    <div
      class="w-2/3 bg-board text-white text-center py-3 rounded-md shadow mb-6"
    >
      üßë‚Äçüè´ Blackboard
    </div>

    <!-- Classroom Grid -->
    <div
      id="seat-map"
      class="grid gap-4 bg-white rounded-xl shadow-lg p-6 w-2/3"
      style="grid-template-columns: repeat(auto-fit, minmax(100px, 1fr))"
    >
      {% for i in range(1, total_benches + 1) %} {% if i in allocated_benches %}
      <div
        class="bench allocated bg-benchAlloc text-white text-lg font-semibold rounded-lg flex items-center justify-center shadow cursor-pointer transition-transform hover:scale-105"
        data-bench="{{ i }}"
        data-tooltip="{{ allocated_benches[i]['name'] }} ({{ allocated_benches[i]['usn'] }})"
      >
        Bench {{ i }}
      </div>
      {% else %}
      <div
        class="bench free bg-benchFree text-white text-lg font-semibold rounded-lg flex items-center justify-center shadow cursor-pointer transition-transform hover:scale-105"
        data-bench="{{ i }}"
      >
        Bench {{ i }}
      </div>
      {% endif %} {% endfor %}
    </div>

    <!-- Legend -->
    <div class="flex gap-6 mt-6">
      <div class="flex items-center gap-2">
        <div class="w-5 h-5 bg-benchFree rounded"></div>
        <span>Free Bench</span>
      </div>
      <div class="flex items-center gap-2">
        <div class="w-5 h-5 bg-benchAlloc rounded"></div>
        <span>Allocated Bench</span>
      </div>
    </div>

    <a
      href="{{ url_for('admin_dashboard') }}"
      class="mt-8 inline-block bg-blue-600 hover:bg-blue-700 text-white py-2 px-5 rounded-lg shadow"
    >
      ‚¨Ö Back to Dashboard
    </a>

    <!-- Interaction script (same as before) -->
    <script>
      const classroomName = "{{ classroom_name }}";

      document.querySelectorAll(".bench").forEach((bench) => {
        bench.addEventListener("click", async () => {
          const benchNo = bench.dataset.bench;

          if (bench.classList.contains("allocated")) {
            if (confirm(`Deallocate bench ${benchNo}?`)) {
              const res = await fetch(`/admin/deallocate_bench`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  classroom_name: classroomName,
                  bench_no: benchNo,
                }),
              });
              const data = await res.json();
              alert(data.message);
              if (data.status === "success") location.reload();
            }
          } else {
            const usn = prompt("Enter USN to allocate to this bench:");
            if (usn) {
              const res = await fetch(`/admin/allocate_bench`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  classroom_name: classroomName,
                  bench_no: benchNo,
                  usn,
                }),
              });
              const data = await res.json();
              alert(data.message);
              if (data.status === "success") location.reload();
            }
          }
        });
      });
    </script>
  </body>
</html>
