<!DOCTYPE html>
<html>
  <head>
    <title>Admin Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>

  <body class="bg-light">
    <div class="container mt-5">
      <h2 class="mb-3">Admin Dashboard</h2>
      <hr />

      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %} {% for category, msg in messages %}
      <div class="alert alert-{{ category }}">{{ msg }}</div>
      {% endfor %} {% endif %} {% endwith %}

      <!-- STUDENT SECTION -->
      <section class="mb-5">
        <h4>Manage Students</h4>
        <form
          method="POST"
          action="{{ url_for('admin.add_student') }}"
          class="row g-2 mt-2"
        >
          <div class="col-md-3">
            <input
              type="text"
              name="usn"
              class="form-control"
              placeholder="USN"
              required
            />
          </div>
          <div class="col-md-4">
            <input
              type="text"
              name="name"
              class="form-control"
              placeholder="Student Name"
              required
            />
          </div>
          <div class="col-md-3">
            <input
              type="text"
              name="dept_code"
              class="form-control"
              placeholder="Dept Code (CSE/CD/CY)"
              required
            />
          </div>
          <div class="col-md-2 d-grid">
            <button class="btn btn-primary">Add</button>
          </div>
        </form>
        <hr />
        <form
          method="POST"
          action="{{ url_for('upload_students') }}"
          enctype="multipart/form-data"
          class="mt-3"
        >
          <input
            type="file"
            name="file"
            class="form-control"
            accept=".csv"
            required
          />
          <button class="btn btn-primary">Upload CSV</button>
        </form>

        <hr />

        <h4>Upload Classroom CSV</h4>
        <form
          method="POST"
          action="{{ url_for('upload_classrooms') }}"
          enctype="multipart/form-data"
        >
          <input
            type="file"
            name="file"
            class="form-control my-2"
            accept=".csv"
            required
          />
          <button class="btn btn-primary">Upload</button>
        </form>

        <hr />

        <h4>Upload Exam Sessions CSV</h4>
        <form
          method="POST"
          action="{{ url_for('upload_exams') }}"
          enctype="multipart/form-data"
        >
          <input
            type="file"
            name="file"
            class="form-control my-2"
            accept=".csv"
            required
          />
          <button class="btn btn-primary">Upload</button>
        </form>

        <div class="table-responsive mt-4">
          <table class="table table-striped table-bordered">
            <thead>
              <tr>
                <th>USN</th>
                <th>Name</th>
                <th>Dept</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for s in students %}
              <tr>
                <td>{{ s.usn }}</td>
                <td>{{ s.name }}</td>
                <td>{{ s.dept_code }}</td>
                <td>
                  <a
                    href="{{ url_for('admin.delete_student', usn=s.usn) }}"
                    class="btn btn-sm btn-danger"
                    onclick="return confirm('Delete {{ s.usn }}?');"
                    >Delete</a
                  >
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </section>

      <!-- CLASSROOM SECTION -->
      <section class="mb-5">
        <h4>Manage Classrooms</h4>
        <form
          method="POST"
          action="{{ url_for('admin.add_classroom') }}"
          class="row g-2 mt-2"
        >
          <div class="col-md-3">
            <input
              type="text"
              name="classroom_name"
              class="form-control"
              placeholder="Classroom Name"
              required
            />
          </div>
          <div class="col-md-2">
            <input
              type="text"
              name="dept_code"
              class="form-control"
              placeholder="Dept"
              required
            />
          </div>
          <div class="col-md-2">
            <input
              type="number"
              name="no_of_benches"
              class="form-control"
              placeholder="Benches"
              required
            />
          </div>
          <div class="col-md-2">
            <input
              type="number"
              name="bench_capacity"
              class="form-control"
              placeholder="Capacity"
              required
            />
          </div>
          <div class="col-md-2">
            <input
              type="text"
              name="location"
              class="form-control"
              placeholder="Location"
            />
          </div>
          <div class="col-md-1 d-grid">
            <button class="btn btn-primary">Add</button>
          </div>
        </form>

        <div class="table-responsive mt-4">
          <table class="table table-striped table-bordered">
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Dept</th>
                <th>Benches</th>
                <th>Capacity</th>
                <th>Location</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for c in classrooms %}
              <tr>
                <td>{{ c.classroom_id }}</td>
                <td>{{ c.classroom_name }}</td>
                <td>{{ c.dept_code }}</td>
                <td>{{ c.no_of_benches }}</td>
                <td>{{ c.bench_capacity }}</td>
                <td>{{ c.location }}</td>
                <td>
                  <a
                    href="{{ url_for('admin.delete_classroom', id=c.classroom_id) }}"
                    class="btn btn-sm btn-danger"
                    onclick="return confirm('Delete {{ c.classroom_name }}?');"
                    >Delete</a
                  >
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </section>

      <!-- EXAM SESSION SECTION -->
      <section class="mb-5">
        <h4>Manage Exam Sessions</h4>
        <form
          method="POST"
          action="{{ url_for('admin.add_exam_session') }}"
          class="row g-2 mt-2"
        >
          <div class="col-md-2">
            <input
              type="text"
              name="subject_code"
              class="form-control"
              placeholder="Subject"
              required
            />
          </div>
          <div class="col-md-3">
            <input
              type="datetime-local"
              name="start_time"
              class="form-control"
              required
            />
          </div>
          <div class="col-md-3">
            <input
              type="datetime-local"
              name="end_time"
              class="form-control"
              required
            />
          </div>
          <div class="col-md-2">
            <input
              type="text"
              name="dept_code"
              class="form-control"
              placeholder="Dept"
              required
            />
          </div>
          <div class="col-md-2 d-grid">
            <button class="btn btn-primary">Add</button>
          </div>
        </form>

        <div class="table-responsive mt-4">
          <table class="table table-striped table-bordered">
            <thead>
              <tr>
                <th>ID</th>
                <th>Subject</th>
                <th>Start</th>
                <th>End</th>
                <th>Dept</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for e in exams %}
              <tr>
                <td>{{ e.exam_id }}</td>
                <td>{{ e.subject_code }}</td>
                <td>{{ e.start_time }}</td>
                <td>{{ e.end_time }}</td>
                <td>{{ e.dept_code }}</td>
                <td>{{ e.status }}</td>
                <td>
                  <a
                    href="{{ url_for('admin.delete_exam_session', id=e.exam_id) }}"
                    class="btn btn-sm btn-danger"
                    onclick="return confirm('Delete {{ e.subject_code }}?');"
                    >Delete</a
                  >
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </section>
      <!-- ALLOCATION SECTION -->
      <section class="mb-5">
        <h4>Seat Allocation</h4>

        <form
          method="POST"
          action="{{ url_for('allocate_seats_route') }}"
          class="row g-2 mt-2"
        >
          <div class="col-md-4">
            <input
              type="text"
              name="subject_code"
              class="form-control"
              placeholder="Enter Subject Code"
              required
            />
          </div>
          <div class="col-md-2 d-grid">
            <button class="btn btn-success">Allocate Seats</button>
          </div>
        </form>

        <form
          method="POST"
          action="{{ url_for('deallocate_seats_route') }}"
          class="row g-2 mt-2"
        >
          <div class="col-md-4">
            <input
              type="text"
              name="subject_code"
              class="form-control"
              placeholder="Enter Subject Code"
              required
            />
          </div>
          <div class="col-md-2 d-grid">
            <button class="btn btn-danger">Deallocate Seats</button>
          </div>
        </form>
      </section>
    </div>
  </body>
</html>
